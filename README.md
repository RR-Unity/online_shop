# Электронный магазин

### Запуск

Команды необходимо вводить в терминале.

1. Для установки зависимостей необходимо запустить команду:
```bash
pipenv install
```

2. Для запуска виртуального окружения
```bash
pipenv shell
```

3. Для применения миграция в бд необходимо вызвать команду:
```bash
alembic upgrade head
```

4. Для запуска приложения нужно воспользоваться командой:
```bash
pipenv run main
```


В проекте уже лежит файл с необходимыми параметрами окружения:

- DB_URL=Database URL, пример: ```postgresql+asyncpg://login:password@host:port/your_db```
- DB_URL_TEST=test database URL
- DEF_ITEMS_ON_PAGE - - Максимальное количество элементов в ответе(по умолчанию)

- UVICORN_WORKERS=Int - default 1           - Количество воркеров самого приложения
- UVICORN_HOST=Str - default '127.0.0.1'    - Адрес хоста приложения
- UVICORN_PORT=Int - default 'localhost'    - Адрес порта приложения
- API_PREFIX=Str - default ''

- LOGGER_LEVEL=INFO             - Устанавливает какой минимальный уровень ошибок будет отображать логгер
- DEVELOPER_MODE=bool|None      - Позволяет пользоваться утилитами разработчика, включает reload и hinting библиотек разработки_
- DEBUG=bool|None               - Выводит сырые SQL запросы в консоль

При возникновении проблем нужно проверить корректность их заполнения.


## Алгоритм работы роутов

- ### BASKET /POST (Добавление товара в корзину)

##### Принимаемые параметры в теле запроса:
{
  "product_id": 1, 
  "count": 1
}, где product_id - уникальный идентификатор продукта, count - количество единиц, которое необходимо добавить в корзину.

##### Алгоритм работы:
1. Проверяется существование продукта с переданным product_id (если такого продукта нет - будет ошибка).
2. Проверяется наличие данного продукта в корзине (вдруг он уже добавлен) (если он уже есть - будет ошибка).
3. Проверяется что параметр count >= 0 (если он меньше 0 - будет ошибка).
4. Если все проверки успешно пройдены, товар добавляется в таблицу Basket и возвращается соответствующая запись.

##### CURL COMMAND:
```bash
curl -X 'POST' \
  'http://localhost:8888/basket' \
  -H 'accept: application/json' \
  -H 'Content-Type: application/json' \
  -d '{
  "product_id": 1,
  "count": 1
}'
```

- ### BASKET /PATCH (Обновление количества товара в корзине)

##### Принимаемые параметры в теле запроса:
{
  "product_id": 2,
  "count": 2
}, где product_id - уникальный идентификатор продукта, count - количество единиц, которое должно стать в корзине.

##### Алгоритм работы:
1. Проверяется существование продукта с переданным product_id (если такого продукта нет - будет ошибка).
2. Проверяется что параметр count >= 0 (если он меньше 0 - будет ошибка).
3. Проверяется наличие данного продукта в корзине (вдруг он уже добавлен). Если такого продукта нет в корзине,
то он туда добавляется.
4. Если переданное занчение count равно значению в базе то будет ошибка.
5. Если переданное значение count=0 и продукт есть в корзине, то он оттуда удаляется.
6. Если переданное значение count корректно, продукт есть в корзине, то его количество там обновляется 
(и параметр total_price тоже).

##### CURL COMMAND:
```bash
curl -X 'PATCH' \
  'http://localhost:8888/basket' \
  -H 'accept: application/json' \
  -H 'Content-Type: application/json' \
  -d '{
  "product_id": 2,
  "count": 2
}'
```

- ### PRODUCTS GET /products (получение списка продуктов)

##### Принимаемые параметры:
  - name - имя продукта
  - price - цена за единицу

##### Алгоритм работы:
1. Из бд запрашивается нужна информация согласно указанным фильтрам.

##### CURL COMMAND (поиск товара по названию):
```bash
curl -X 'GET' \
  'http://localhost:8888/products?page=1&size=10&name=string' \
  -H 'accept: application/json'
```


- ### PRODUCTS POST /products (создание продукта)

##### Принимаемые параметры:
  - name - имя продукта
  - price - цена за единицу

##### Алгоритм работы:
1. Проверяется что параметр price >= 0 (если он меньше 0 - будет ошибка).
2. Создаётся запись в таблице Product и возвращается.


##### СURL COMMAND (создание товара):
```bash
curl -X 'POST' \
  'http://localhost:8888/products' \
  -H 'accept: application/json' \
  -H 'Content-Type: application/json' \
  -d '{
  "name": "string2",
  "price": 2.2
}'
```


